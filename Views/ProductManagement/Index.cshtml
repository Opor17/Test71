@using _71BootlegStore.ViewModels
@model ProductManagementVM

@{
    ViewData["Title"] = "Product Management";
}

<div class="content">

	<h2 class="intro-y text-lg font-medium mt-10">
		Product Management
	</h2>

	<div class="grid grid-cols-12 gap-6 mt-5">
		<div class="intro-y col-span-12 flex flex-wrap sm:flex-nowrap items-center mt-2">
			<a asp-controller="ProductManagement" asp-action="Create" class="btn btn-primary shadow-md mr-2">
				Create Product
			</a>
		</div>

		<div class="intro-y col-span-12 overflow-auto lg:overflow-visible">
			<div class="relative overflow-x-auto">
				<table id="dataTable" class="table table-report -mt-2">
					<thead>
						<tr>
							<th class="whitespace-nowrap">
								<label asp-for="@Model.ProductManagement.Id"></label>
							</th>
							<th class="whitespace-nowrap">
								<label asp-for="@Model.ProductManagement.Name"></label>
							</th>
							<th class="whitespace-nowrap">
								<label asp-for="@Model.ProductManagement.Image"></label>
							</th>
							<th class="whitespace-nowrap">
								<label asp-for="@Model.ProductManagement.Quantity"></label>
							</th>
							<th class="whitespace-nowrap">
								<label asp-for="@Model.ProductManagement.Gender"></label>
							</th>
							<th class="whitespace-nowrap">
								<label asp-for="@Model.ProductManagement.Price"></label>
							</th>
							<th class="whitespace-nowrap">
								<label asp-for="@Model.ProductManagement.Color"></label>
							</th>
							<th class="whitespace-nowrap">
								<label asp-for="@Model.ProductManagement.Size"></label>
							</th>
							<th class="whitespace-nowrap">
								<label asp-for="@Model.ProductManagement.Status"></label>
							</th>
							<th class="whitespace-nowrap">
								<label asp-for="@Model.ProductManagement.CreatedAt"></label>
							</th>
							<th class="whitespace-nowrap">
								<label asp-for="@Model.ProductManagement.UpdatedAt"></label>
							</th>
							<th class="text-center whitespace-nowrap">ACTION</th>
						</tr>
					</thead>
					<tbody>
						@{
							int key = 0;
						}
						@foreach (var productManagements in Model.ProductManagements)
						{
							key++;
							<tr class="intro-x h-16">
								<td class="whitespace-nowrap">@key</td>
								<td class="whitespace-nowrap">@productManagements.Name</td>
								<td class="whitespace-nowrap"><img alt="Midone - HTML Admin Template" data-action="zoom" src="@productManagements.Image" width="100" height="100" /></td>
								<td class="whitespace-nowrap">
									@if (@productManagements.Quantity <= 10)
									{
										<label class="text-danger">@productManagements.Quantity</label>
									}
									else
									{
										<label>@productManagements.Quantity</label>
									}
								</td>
								<td class="whitespace-nowrap">
									@if (productManagements.Gender)
									{
										<div>ผู้ชาย</div>
									}
									else
									{
										<div>ผู้หญิง</div>
									}
								</td>
								<td class="whitespace-nowrap">@productManagements.Price</td>
								<td class="whitespace-nowrap">@productManagements.Color</td>
								<td class="whitespace-nowrap">@productManagements.Size</td>

								<td class="whitespace-nowrap">
									@if (productManagements.Status)
									{
										<div class='flex items-center text-success'><i data-lucide='check-square' class='w-4 h-4 mr-2'></i>Active</div>
									}
									else
									{
										<div class='flex items-center text-danger'><i data-lucide='check-square' class='w-4 h-4 mr-2'></i>Inactive</div>
									}
								</td>
								<td class="whitespace-nowrap">@productManagements.CreatedAt.ToString("dd/MM/yyyy")</td>
								<td class="whitespace-nowrap">@productManagements.UpdatedAt.ToString("dd/MM/yyyy")</td>
								<td class="table-report__action w-56">
									<div class="flex justify-center items-center">
										<a class="flex items-center mr-3" asp-controller="ProductManagement" asp-action="Create" asp-route-id="@productManagements.Id">
											<i data-lucide="check-square" class="w-4 h-4 mr-1"></i> Edit
										</a>
										<a class="flex items-center text-danger js-delete" href="javascript:;" data-id="@productManagements.Id" data-batch="@productManagements.Image">
											<i data-lucide="trash-2" class="w-4 h-4 mr-1"></i>
											Delete
										</a>
									</div>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

@section Scripts
{
	<script>
		const breadcrumbs = [
			{
				"label": "Master Data",
				"url": "javascript:;"
			},
			{
				"label": "Product Management",
				"url": "javascript:;"
			}

		];
		activeMenu(breadcrumbs);

		$(document).ready(function () {
			$('#dataTable').DataTable();

			setTimeout(() => {
				window.location.reload();
			}, 100000);

			// delete datatable item
			$(document).on('click', '.js-delete', function () {
				let itemId = $(this).attr('data-id');
				let Image = $(this).attr('data-batch');
				Swal.fire({
					title: 'Are you sure?',
					text: "You want to remove this Image ",
					icon: 'warning',
					showCancelButton: true,
					confirmButtonColor: '#3085d6',
					cancelButtonColor: '#d33',
					confirmButtonText: 'Yes, delete it!'
				}).then((result) => {
					if (result.isConfirmed) {
						deleteItem(itemId)
					}
				})
			});
			function deleteItem(id) {
				$.ajax({
					type: "DELETE",
					url: "@Url.Action("DeleteItem")" + "/" + id,
					success: function (data) {
						if (data == 'success') {
							window.location.reload();
						}
					},
					error: function (error) {
					},
				});
			}

			// edit datatable item
			let itemId;
			var Images;
			$(document).on('click', '.js-edit', function () {
				itemId = $(this).attr('data-id');
				Images = $(this).attr('data-batch');
			});

			$('.saveEdit').on('click', function () {
				let formData = new FormData($('#frmData')[0]);
				formData.append('Image', Images);
				$.ajax({
					type: "POST",
					url: "@Url.Action("Save")" + "/" + itemId,
					data: formData,
					dataType: 'json',
					processData: false,
					contentType: false,
					success: function (response) {
						if (response == 'success') {
							window.location.reload();
						}
					},
					error: function (jqXHR, textStatus, errorThrown) {
						$('.field-validation-valid').text('');
						for (const key in jqXHR.responseJSON) {
							$('.field-validation-valid[data-valmsg-for="' + key + '"]').text(jqXHR.responseJSON[key][0]);
						}
					}
				});
			})

		});
	</script>
}